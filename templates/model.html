<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>急重症風險分析支援系統</title>
    <link rel="stylesheet" href="static/assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Inter:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800&amp;display=swap">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="static/CSS/load-others.css">
    <script src="static/JavaScript/load-others.js"></script>
    <link rel="shortcut icon" href="./static/images/ccass.ico" type="image/x-icon">
</head>

<body>
    <div class="loading-wrapper" style="display:none ;">
		<div class="loading-grid">
			<div class="loading">
				<img src="static/gif/walking_people.gif" height="35%">
				<div class="containerForText">
					<div class="Text text-background">模型訓練中...<div id="time" class="Text text-background">
                    
                    </div></div>
					<div class="Text text-color">模型訓練中...</div>
                    
				</div>
                
                <script>
                    
                </script>
				<!-- <div class="progress">
					<div class="progress-value"></div>
				</div> -->
			</div>
		</div>
	</div>
    <nav class="navbar navbar-light navbar-expand-md sticky-top navbar-shrink py-3" id="mainNav">
        <div class="container"><a class="navbar-brand d-flex align-items-center" href="/"><span
                    class="bs-icon-sm bs-icon-circle bs-icon-primary shadow d-flex justify-content-center align-items-center me-2 bs-icon"><svg
                        xmlns="http://www.w3.org/2000/svg" viewBox="-32 0 512 512" width="1em" height="1em"
                        fill="currentColor" style="font-size: 28px;">
                        <!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. -->
                        <path
                            d="M352 128C352 198.7 294.7 256 223.1 256C153.3 256 95.1 198.7 95.1 128C95.1 57.31 153.3 0 223.1 0C294.7 0 352 57.31 352 128zM287.1 362C260.4 369.1 239.1 394.2 239.1 424V448C239.1 452.2 241.7 456.3 244.7 459.3L260.7 475.3C266.9 481.6 277.1 481.6 283.3 475.3C289.6 469.1 289.6 458.9 283.3 452.7L271.1 441.4V424C271.1 406.3 286.3 392 303.1 392C321.7 392 336 406.3 336 424V441.4L324.7 452.7C318.4 458.9 318.4 469.1 324.7 475.3C330.9 481.6 341.1 481.6 347.3 475.3L363.3 459.3C366.3 456.3 368 452.2 368 448V424C368 394.2 347.6 369.1 320 362V308.8C393.5 326.7 448 392.1 448 472V480C448 497.7 433.7 512 416 512H32C14.33 512 0 497.7 0 480V472C0 393 54.53 326.7 128 308.8V370.3C104.9 377.2 88 398.6 88 424C88 454.9 113.1 480 144 480C174.9 480 200 454.9 200 424C200 398.6 183.1 377.2 160 370.3V304.2C162.7 304.1 165.3 304 168 304H280C282.7 304 285.3 304.1 288 304.2L287.1 362zM167.1 424C167.1 437.3 157.3 448 143.1 448C130.7 448 119.1 437.3 119.1 424C119.1 410.7 130.7 400 143.1 400C157.3 400 167.1 410.7 167.1 424z">
                        </path>
                    </svg></span><span>急重症風險分析支援系統</span></a><button data-bs-toggle="collapse" class="navbar-toggler"
                data-bs-target="#navcol-1"><span class="visually-hidden">Toggle navigation</span><span
                    class="navbar-toggler-icon"></span></button>
            模型版本系統
            <div class="collapse navbar-collapse" id="navcol-1">
                <ul class="navbar-nav mx-auto"></ul><a class="btn btn-dark text-start shadow" role="button"
                    href="/patientlist">Back</a>
            </div>
        </div>
    </nav>
    
    <section class="text-center py-5">
        <div class="container ">
            <!-- center  -->
            <div class="row " style="margin: auto;">
                <div class="col mb-3">
                    <ul class="nav nav-pills d-flex justify-content-center">
                        <li class="nav-item">
                            <button class="nav-link active" id="page3-click">模型上傳</button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link " id="page1-click" aria-current="page">模型效能</button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" id="page2-click">基本統計資料</button>
                        </li>
                        
                    </ul>
                </div>

                <h1 class="mb-3">Version NF:{{nowUse[1]}} Sepsis:{{nowUse[2]}}</h1>
                <form action="/model" method="POST" enctype="multipart/form-data"id='form'>
                    <div class="row">

                        <div class="form-floating col-md-4 mb-3">

                            <select class="form-select" name="type" id="type">
                                <option value="NF" selected="">NF</option>
                                <option value="Sepsis">Sepsis</option>
                            </select>
                            <label class="form-label" for="type">
                                modelType:
                            </label>
                        </div>
                        <div class=" col-md-4 mb-3">

                            <input id='file' class='form-control form-control-lg' type="file" name="file">

                        </div>
                        <div class="form-floating col-md-1 mb-3 page1">
                            <ul class="nav nav-pills d-flex justify-content-center">
                                <li class="nav-item">
                                    <button class="nav-link active" id="flexRadioDefault1" type="button">Split</button>
                                </li>
                                <li class="nav-item">
                                    <button class="nav-link " id="flexRadioDefault2" aria-current="page"type="button">Fold</button>
                                </li>
                                
                                
                            </ul>
                           
                            
                        </div>
                        <div class="form-floating col-md-3 mb-3 page1">
                            <input id="fold" class="form-control" type="number" value="1" min="1" name="fold">
                            <label id ='fold-label'class="form-label" for="fold">
                                 Folds Times:
                            </label>
                            <input id="split" class="form-control" type="range" value="80" min="0" max="100"
                                name="split">
                            <label id ='split-label' class="form-label" for="split" id="split-value">
                                 split 80%
                            </label>
                            <script>
                                
                            </script>

                        </div>
                        <div class="form-floating col-md-4 mb-3">
                            <input id="startDate" class="form-control" type="date" name="startDate">
                            <label class="form-label" for="startDate ">
                                startDate:
                            </label>
                        </div>
                        <div class="form-floating col-md-4 mb-3">
                            <input id="endDate" class="form-control" type="date" name="endDate">
                            <label class="form-label" for="endDate">endDate:</label>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <button class="btn btn-dark btn-md" type="submit" id="submit">Upload DataSet</button>
                        </div>
                        <div class="col-md-4 mb-3 page2">
                           
                        </div>
                    </div>

                    
                </form>
                <hr>
                <div class="page2 mb-3">
                    <div class=" form-floating mb-3  input-group">
                       
                        
                        
                        <select class='form-select'id="attributeSelect"></select>
                        <label class='form-label'for="attributeSelect">選擇Attribute:</label>
                        <button class="btn btn-outline-dark "id='showinfo' data-bs-toggle="modal" data-bs-target="#exampleModal">chi square</button>
                        <!-- Button trigger modal -->
                    </div>
  <!-- Modal -->
  <div class="modal modal-xl fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" >
            <div class="row">
                <div class="col-2"style="border-right:1pt solid;">
                    Name
                </div>
                <div class="col-4" id='get'style="border-right:1pt solid;">
                    get
                </div>
                <div class="col-4" id='non-get'style="border-right:1pt solid;">
                    Non-get
                </div>
                <div class="col-2"style="border-right:1pt solid;">
                    P-value
                </div>

            </div>
          <div id="info"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-dark" data-bs-dismiss="modal">Close</button>
          
        </div>
      </div>
    </div>
  </div>
                        
                        
                    
                    
                    
                    <label id="min">Min </label>
                    <label id="max">Max </label>
                    <label id="mean">Mean </label>
                    <label id="std">Std </label>
                    <label id="miss">Missing </label>
                    <label id="dataType">dataType </label>
                    <canvas id="chart"></canvas>
                    <script src="static/JavaScript/drawChart.js"></script>
                </div>
                
                <form class="page1 mb-3 page3" action="/model" method="GET">
                    <div class="row" style="text-align: center;">
                        <div class="col-md-2 form-floating mb-3">

                            <select id="modelTypeQ" class=" form-select " name="typeQ">
                                <option value="" selected="">all</option>
                                <option value="NF">NF</option>
                                <option value="Sepsis">Sepsis</option>
                            </select>
                            <label class="form-label" for="modelType-q">
                                ModelType:
                            </label>
                        </div>
                        <div class="col-md-2 form-floating mb-3">
                            <input class="form-control" type="text" style="text-align: justify;" name="modelVersionQ"
                                id="modelVersionQ">
                            <label class="form-label" for="modelVersion-q">
                                ModelVersion:
                            </label>
                        </div>
                        <div class="col-md-3 form-floating mb-3">
                            <input class="form-control" type="date" name="startDateQ" id="startDateQ">
                            <label class="form-label" for="startDate-q">StartDate:</label>
                        </div>
                        <div class="col-md-3 form-floating mb-3">
                            <input class="form-control" type="date" name="endDateQ" id="endDateQ">
                            <label class="form-label" for="endDat-qe">EndDate:</label>
                        </div>
                        <!-- <div class="col-lg-10 text-start"><label
                            class="form-label">UpdateTime:</label><input type="date"></div>
                    </div> -->

                        <div class="col mb-2">
                            <button class="btn btn-dark btn-md  queryModel" type="button">Search</button>
                        </div>
                    </div>
                </form>
                {% for model in models %}
                <div class=" row text-start justify-content-center  align-items-center  ">

                    <div class="col-8 col-md-8 col-lg-8 text-start page1 page3">
                        <div class="card">
                            <div class="card-body ">
                                <h4 class="card-title ">{{model[5]}} Version:{{model[0]}} </h4>
                                <div class="page1">Split :{{model[7]}} Fold :{{model[6]}}</div>
                                <script>

                                </script>
                                <h6 class="text-muted card-subtitle mb-2">UpdateTime {{model[3]}}</h6>
                                <p class="card-text page1 page3">
                                    {% if modelEfficacy[loop.index0] != None %}
                                    {% for key,value in modelEfficacy[loop.index0].items() %}
                                    {% if value!=None %}
                                <div class="row page1 page3" >

                                    <div class="row "><h3>{{key}}</h3></div>
                                    {% for inKey,inValue in value.items()%}
                                    <div class="col text-center">

                                        <div class="col"><h4>{{inKey}}</h4></div>
                                        <hr>
                                        <div class="col">{{inValue|round(3)}}</div>
                                    </div>
                                    {% endfor %}
                                </div>
                                <hr class="page1">
                                {% endif %}

                                {% endfor %}
                                {% endif %}
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4 text-center page3">
                        <button class="btn btn-primary selectModel {{model[5]}}" id='{{model[0]}}' type="button">Use
                            This Model</button>
                        <button class="btn btn-danger deleteModel {{model[5]}}" id="{{model[0]}}"
                            type="button">Delete</button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/bold-and-bright.js"></script>
    
    <script src="https://apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
</body>
<script>

    $(document).ready(function () {
        $("#split").on("input", function () {
            console.log("change",this.value)
            $("#split").val(this.value)
            document.getElementById("split-label").innerHTML = "Split : "+this.value+"%"
        })
        
            $('#showinfo').click(function() {
                
                var formData = new FormData($('#form')[0]);
                
                $.ajax({
                    url: '/pvalue',
                    type: 'POST',
                    data: formData,
                    async: false,
                    cache: false,
                    contentType: false,
                    processData: false,
                    success: function(response) {

                        console.log(response)
                        var typ=response[0]
                        if(typ){
                            document.getElementById('get').innerText='NF'
                            document.getElementById('non-get').innerText='non-NF'

                            
                        }else{
                            document.getElementById('get').innerText='Sepsis'
                            document.getElementById('non-get').innerText='non-Sepsis'
                        }
                        response=response[1]
                        target=document.getElementById("info")
                        html="<hr>"
                        for (let i =0;i<response.length;i++){
                            html+="<div class='row'>"
                            for(let j=0;j<response[i].length;j++){
                                if(j==2 ||j==4){
                                    html+='<div class="col" style="text-align:left;border-right:1pt solid;">('+response[i][j]+'%)</div>'

                                }else if(j==0){

                                    html+='<div class="col" style="border-right:1pt solid;">'+response[i][j]+'</div>'
                                }else{
                                    html+='<div class="col" >'+response[i][j]+'</div>'
                                }

                            }
                            html+="</div>"
                        }
                        target.innerHTML=html
                        
                    },
                    error: function() {
                        alert('An error occurred while processing the file.');
                    }
                });
                return false;
            });
        
        $('#fold').hide()
        $('#fold-label').hide()
        $('#flexRadioDefault1').click(()=>{
            
               $('#flexRadioDefault1').addClass('active')
               $('#flexRadioDefault2').removeClass('active')

               $('#fold').hide()
               $('#fold-label').hide()
               $('#split').show()
               $('#split-label').show()
                $("#fold").val(1)
                
            
        
        })
        $('#flexRadioDefault2').click(()=>{
            
            $('#flexRadioDefault2').addClass('active')
               $('#flexRadioDefault1').removeClass('active')
                
            
                $('#split').hide()
                $('#split-label').hide()
                $('#fold').show()
                $('#fold-label').show()
                $("#split").val(80)
                $("#split").trigger("input")
    })
        $('.page2').hide()
        $('.page1').hide()
        $('.page3').show()
        $('#submit').click(()=>{
            
                $('.loading-wrapper').show()
                var time = 0;
                    var timer = setInterval(function(){
                        time++;
                        document.getElementById("time").innerHTML = time;
                    },1000);
            
        })
        $('#page1-click').click(function () {
            //remove class active
            $('#page2-click').removeClass('active')
            $('#page3-click').removeClass('active')
            $('#page1-click').addClass('active')
            
            $('.page2').hide()
            $('.page3').hide()
            $('.page1').show()
        })
        $('#page2-click').click(function () {
            //remove class active
            //check if file has been uploaded
            if ($('#file').val() == "") {
                alert("請先上傳檔案")
                $( "#file" ).effect( "shake" );
                return
            }
            $('#page1-click').removeClass('active')
            $('#page3-click').removeClass('active')
            $('#page2-click').addClass('active')
            $('.page1').hide()
            $('.page3').hide()
            $('.page2').show()
        })
        $('#page3-click').click(function(){
            $('#page1-click').removeClass('active')
            $('#page2-click').removeClass('active')
            $('#page3-click').addClass('active')
            
            $('.page1').hide()
            $('.page2').hide()
            $('.page3').show()
        })
        //ajax to select model
        $(".selectModel").click(function (event) {
            console.log(event.target.id)
            $.ajax({
                type: "POST",
                url: "/model/select",
                data: {
                    modelVersion: event.target.id,
                    type: event.target.classList[3]
                },
                success: function (response) {
                    alert("更換成功")
                    console.log(response);
                    window.location.reload()
                },
                error: function (error) {
                    alert("更換失敗")
                    console.log(error);
                }
            })
        })
        //ajax to delete model
        $(".deleteModel").click(function (event) {
            console.log(event.target.id)
            $.ajax({
                type: "DELETE",
                url: "/model",
                data: {
                    modelVersion: event.target.id,
                    type: event.target.classList[3]
                },
                success: function (response) {
                    alert("刪除成功")
                    console.log(response);
                    window.location.reload()
                },
                error: function (error) {
                    alert("刪除失敗")
                    console.log(error);
                }
            })
        })
        //ajax to query model with get method
        $(".queryModel").click(function (event) {
            window.location.href = "/model?type=" + $("#modelTypeQ").val() + "&modelVersion=" + $("#modelVersionQ").val()+
            "&startDate="+$("#startDateQ").val()+"&endDate="+$("#endDateQ").val()
        })
    })





</script>

</html>